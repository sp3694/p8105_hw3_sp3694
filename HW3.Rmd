---
title: "HW3"
author: "Stephen Powers"
date: "10/12/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```


```{r data, include=FALSE}
library(p8105.datasets)
data("instacart")
data("brfss_smart2010")
```

## Problem 1

#### *Cleaning Instacart Dataset*

```{r echo=FALSE}
instacart %>% 
  janitor::clean_names() %>% 
  head() %>% 
  knitr::kable(
    caption = "Table 1"
  )
```

The `instacart` dataset contains `r nrow(instacart)` observations and `r ncol(instacart)` variables. The variables in the dataset includes the following: `r colnames(instacart)`

* There are `r length(unique(pull(instacart, aisle)))` total aisles in the dataset. 

```{r echo=FALSE}
instacart %>% 
  select(product_id, product_name, aisle) %>% 
  count(product_id, product_name, aisle) %>% 
  arrange(desc(n)) %>% 
  head(15) %>% 
  knitr::kable(
    caption = "Table 2"
  )
```

* From the table created above, we see that the most ordered items are from the "fresh fruits" and "packaged vegetables fruits" aisles. 


```{r plot1, echo=FALSE}
instacart %>% 
  group_by(aisle) %>% 
  count() %>% 
  filter(n > 10000) %>% 
  ggplot(aes(x = reorder(aisle, n), y = n)) +
  geom_bar(stat = "identity") +
  theme_classic() +
  ggtitle("Number of Items Ordered in Each Aisle") +
  xlab("Aisle") +
  ylab("Number of items ordered") +
  theme(axis.text.x = element_text(angle=45, hjust=1))
```

#### *Creating a table showing the three most popular items in each of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”.*

```{r echo=FALSE}
instacart %>% 
  filter(aisle == c("baking ingredients","dog food care","packaged vegetables fruits")) %>%
  group_by(aisle, product_name) %>% 
  summarize(
    number_orders = n()) %>% 
  arrange(aisle, desc(number_orders)) %>% 
  mutate(rank = rank(desc(number_orders))) %>% 
  filter(rank<4) %>% 
  pivot_wider(
    id_cols = rank,
    names_from = aisle,
    values_from = c(product_name, number_orders)) %>% 
  knitr::kable(
    caption = "Table 3"
  )
```

#### *Creating a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week*

```{r echo=FALSE}
instacart %>% 
  select(product_name, order_hour_of_day, order_dow) %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  mutate(order_dow = as.factor(order_dow)) %>% 
  mutate(
        day = recode(order_dow,
            "0" = "Sunday",
            "1" = "Monday",
            "2" = "Tuesday",
            "3" = "Wednesday",
            "4" = "Thursday",
            "5" = "Friday",
            "6" = "Saturday")
        ) %>% 
  group_by(product_name, day) %>% 
  arrange(product_name, day) %>% 
  summarize(
    mean_hour = mean(order_hour_of_day)) %>% 
  pivot_wider(
    id_cols = "product_name",
    names_from = "day",
    values_from = "mean_hour",
    ) %>% 
  knitr::kable(
    caption = "Table 4"
  )
```


## Problem 2

#### *Renaming and cleaning data `brfss_smart2010`*

```{r echo=FALSE}
brfss =
  brfss_smart2010 %>% 
    janitor::clean_names() %>% 
    rename(
      state = locationabbr,
      descending_location = locationdesc,
    )
```

#### *Formatting a new dataset to focus on the “Overall Health” topic*

```{r echo=FALSE}
brfss_new = 
  brfss %>% 
    filter(
      topic == "Overall Health",
      response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) %>%
    mutate(response = ordered(as.factor(response),
                              levels = c(
                                "Poor", 
                                "Fair", 
                                "Good", 
                                "Very good", 
                                "Excellent")))
```


## Problem 3


```{r}

```


